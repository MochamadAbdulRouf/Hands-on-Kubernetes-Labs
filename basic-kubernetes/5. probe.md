# Probe di Kubernetes
Probe adalah sebuah mekanisme diagnostik yang dilakukan secara periodik oleh kubelet terhadap sebuah container untuk memastikan container tersebut berada dalam kondisi sehat.Hasil dari probe ini akan menentukan tindakan apa yang di ambil kubernetes.

## Ada tiga jenis probe di kubernetes:

1. Liveness Probe 
Tujuan mendeteksi kapan sebuah aplikasi macet (deadlock) atau berhenti merespon, Meskipun prosesnya secara teknis berjalan. Ini adalah masalah yang tidak bisa dideteksi hanya dengan melihat prosesnya ada atau tidak.
Jika Liveness probe gagal beberapa kali kubelet akan menganggap container tersebut mati dan akan membunuhnya lalu merestartntya sesuai dengan restartPolicy Pod.Ini adalah mekanisme "turn it off and on again" otomatis.

2. Readiness Probe
Tujuan untuk mengetahui kapan sebuah aplikasi siap melayani pengguna.Banyak aplikasi butuh waktu untuk startup: Memuat konfigurasi, Memanaskan cache, Menyambungkan ke database.Mengirim traffic ke aplikasi yang belum siap akan menyebabkan error.

3. Startup Probe
Tujuan khusus untuk aplikasi yang memiliki waktu startup sangat lama (misalnya beberapa menit). Tanpa startup probe, Liveness Probe bisa gagal berkali kali selama proses startup yang panjang dan menyebabkan container di restart sebelum sempat siap.Startup probe akan menonaktifkan Liveness dan Readiness Probe sampai ia berhasil, Seteolah probe berhasil satu kali, Kubelet akan menyerahkan tugas pemeriksaan kesehatan kepada Liveness dan Readiness Probe. Jika Startup Probe gagal, Container akan di restart

## Cara kerja :

Kubernetes bisa melakukan pemeriksaan dengan tiga cara :
1. HTTP GET Kubelet mengirimkan permintaan ke path tertentu misal (/healthz) jika respon 2xx atau 3xx maka probe di anggap berhasil
2. TCP Socket Kubelet mencoba membuka koneksi TCP ke port tertentu di container, Jika koneksi berhasil dibuat probe dianggap berhasil. Ini berguna untuk layanan non-HTTP seperti database
3. Exec Command Kubelet menjalankan sebuah perintah didalam container.Jika perintah tersebut selesai dengan exit code 0, Probe dianggap berhasil

## Pengertian mengenai endpoint
1. Menggunakan path : / (Jalur root)
- Cocok untuk aplikasi sederhana, contoh server web statis(nginx) dimana halaman utama yang berhasil dimuat sudah cukup bukti aplikasi berjalan dengan baik

- Kelebihannya: mudah dan tidak memerlukan pembuatan endpoint tambahan di kode aplikasi

- kekurangan : Jika halaman utama adalah halaman yang kompleks (Misal perlu koneksi ke database dan memanggil layanan lain).Maka probe anda menjadi berat dan lambat.Pemeriksaan harusnya cepat dan ringan

2. Menggunakan endpoint khusus
- Cocok untuk hampir semua aplikasi di lingkungan produksi

- Kelebihannya ringan endpoint dirancang untuk merespons secepat mungkin (Misalnya hanya mengembalikan status 200 OK dengan pesan healthy). Ini tidak akan membenani aplikasi. Lalu kelebihan ke 2 akurat misal livenessProbe ke /health mungkin hanya memeriksa apakah proses server berjalan, sedangkan readinessProbe ke /ready bisa melakukan pemeriksaan lebih mendalam seperti memastikan koneksi ke database sudah siap.

- kekurangan membutuhkan sedikit usaha extra untuk membuat endpoint ini dalam kode aplikasi